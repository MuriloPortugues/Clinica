<!DOCTYPE html>
<html th:replace="~{fragments/layout :: layout(~{::head},~{::main})}"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="~{fragments/head :: head(~{}, ~{::title})}">
    <title>Lista de Consultas</title>
</head>
<body>
<main class="container mt-5">

    <h2 class="text-center fw-bold text-primary mb-4 fs-3">Lista de Consultas Agendadas</h2>

    <div th:if="${mensagemErro}" class="alert alert-danger text-center" role="alert">
        <span th:text="${mensagemErro}"></span>
    </div>

    <table class="table table-striped table-hover">
    </table>

    <!-- Formulário de pesquisa por data -->
    <form th:action="@{/consulta/buscarPorData}" method="get" class="mb-4 d-flex justify-content-center gap-2">
        <input type="date" name="data" class="form-control w-auto" required>
        <button type="submit" class="btn btn-primary">Buscar</button>
    </form>

    <table class="table table-striped table-hover">
        <thead class="table-dark text-center">
        <tr>
            <th>Id</th>
            <th>Data</th>
            <th>Valor</th>
            <th>Observação</th>
            <th>Paciente</th>
            <th>Médico</th>
            <th>Status</th>
            <th class="text-center">Ações</th>

        </tr>
        </thead>
        <tbody class="text-center align-middle">
        <tr th:each="c : ${consultas}">
            <td th:text="${c.id}"></td>
            <td th:text="${#temporals.format(c.data, 'dd/MM/yyyy HH:mm')}"></td>
            <td th:text="${#numbers.formatCurrency(c.valor)}"></td>
            <td th:text="${c.observacao}"></td>
            <td th:text="${c.paciente != null ? c.paciente.nome : 'Sem paciente'}"></td>
            <td th:text="${c.medico != null ? c.medico.nome : 'Sem médico'}"></td>
            <td th:text="${c.status}"></td>

            <td class="text-center">
                <a th:href="@{/consulta/editConsulta/{id}(id=${c.id})}"
                   class="btn btn-warning btn-sm"
                   sec:authorize="hasAnyRole('ROLE_ADMIN','ROLE_MEDICO')">
                    Editar
                </a>
                <a th:href="@{/consulta/removeConsulta/{id}(id=${c.id})}" onclick="return confirm('Tem certeza que deseja excluir este registro?')"
                   class="btn btn-danger btn-sm">Cancelar</a>
            </td>
        </tr>
        </tbody>
    </table>

    <!-- Botões inferiores -->
    <div class="text-center mt-4">
        <a href="/consulta/apresentarConsulta" class="btn btn-info mx-1">Listar Tudo</a>
        <a href="/hospital/home" class="btn btn-secondary mx-1">Home</a>
    </div>

    <!-- Cards -->
    <div class="row mt-5 justify-content-center gap-3">
        <div class="col-md-4">
            <div class="card shadow-sm h-100">
                <div class="card-body text-center">
                    <i class="bi bi-calendar-check-fill fs-1 text-danger"></i>
                    <h5 class="card-title mt-2">Agendar Consultas</h5>
                    <p class="card-text">Acesso para pacientes agendar consultas.</p>
                    <a th:href="@{/agenda/list}" class="btn btn-outline-danger">Agendar</a>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm h-100">
                <div class="card-body text-center">
                    <i class="bi bi-calendar-plus-fill fs-1 text-success"></i>
                    <h5 class="card-title mt-2">Disponibilizar Consulta</h5>
                    <p class="card-text">Acesso para médicos disponibilizar horário para consultas.</p>
                    <a th:href="@{/agenda/disponibilizar}" class="btn btn-outline-success">Disponibilizar</a>
                </div>
            </div>
        </div>
    </div>
</main>
</body>
</html>
